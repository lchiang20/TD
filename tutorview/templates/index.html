{% load staticfiles %}
<!DOCTYPE html>
<script src="{%  static 'assets/admin/js/welcome.js' %}"></script>
<link rel="stylesheet" type="text/css" href="{%  static 'assets/admin/css/index.css' %}">
<script src="{%  static 'assets/admin/js/jquery.min.js' %}" type="text/javascript"></script>
<div class="login-page">
    <div class="form">

        <head>

            <meta name="google-signin-client_id" content="844447968069-sll1lj94217jbntgvtqcm3s2fnan4prt.apps.googleusercontent.com">

        </head>

        <div class="g-signin2" data-onsuccess="onSignIn"></div>{% csrf_token %}
        <button id="login" type="submit">Login</button>

        <script>
            $(document).on("click", '#login', function(e) {
                $(document).ready(function() {
                    var data = {
                        'email': 'filter_city',
                        'id_A': "FGDKJ"
                    };
                    $.ajax({
                        url: '/login_request/',
                        data: data,
                        type: 'GET',
                        success: function(response) { // Go through appliction if does ork then prints
                            console.log(response);
                        },
                        error: function(error) {
                            console.log(error);
                        }
                    });
                });
            })

            $(document).ready(function() {
                var data = {
                    'email': 'filter_city',
                    'id_A': "FGDKJ"
                };
             var token =  $({%  csrf_token %}).attr('value')
                $.ajaxSetup({
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader('Csrf-Token', token);
                    }
                });
                $.ajax({
                    url: '/login_request/',
                    data: data,
                    type: 'GET',
                    success: function(response) { // Go through appliction if does ork then prints
                        console.log(response);
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            });

            function onSignIn(googleUser) {
                var profile = googleUser.getBasicProfile();
                console.log('ID: ' + profile.getId()); // Do not send to your backend! Use an ID token instead.
                console.log('Name: ' + profile.getName());
                console.log('Image URL: ' + profile.getImageUrl());
                console.log('email:  ' + profile.getEmail());let data = new FormData();
                data.append('id', profile.getId());
                data.append('email', profile.getEmail());
                $.ajax({
                    processData: false,
                    contentType: false,
                    url: '/studentview/',
                    data: data,
                    type: 'POST',
                    success: function(response) { // Go through appliction if does work then prints
                        console.log(response);
                    },
                    error: function(error) {
                        console.log(error);
                    }
                });
            }

            function signOut() {
                var auth2 = gapi.auth2.getAuthInstance();
                auth2.signOut().then(function() {
                    console.log('User signed out.');
                });
            }

            function onLoad() {
                gapi.load('auth2', function() {
                    gapi.auth2.init();
                });
            }
        </script>
        <a href="#" onclick="signOut();">Sign out</a>

        <script src="https://apis.google.com/js/platform.js?onload=onLoad" async defer></script>


    </div>
</div>